<!DOCTYPE html>
<html>
<head>
	<title>Hangman!</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
	<link href='https://fonts.googleapis.com/css?family=Share|Unica+One|Ubuntu' rel='stylesheet' type='text/css'>

</head>
<body>
	<div id="lettersHit">
		<p>Press a letter to start playing.</p>
	</div>
	<div id="counter" class="hud">
		<p>Tries Left: 9</p>
	</div>
	<div id="lettersMissed" class="hud">
		<p>Letters Missed</p>
	</div>
	<div id="timer" class="hud">
		<p>0.00 sec</p>
	</div>
	<div id="score" class="hud">
		<p>0</p>
	</div>

		<script type="text/javascript">

		var guessHist=[];
		var missHist=[];
		var	wordToGuess="placeholder";
		var prevWordToGuess="placeholder";
		var wordToGuessArr=["final fantasy vii", "super smash brothers","orcarina of time","x com","chrono trigger","call of duty","elder scrolls"];
		var GuessIndex;
		var wordToGuessRevealed;
		var counter;
		var counterMax=9;
		var k=0;
		var missIndex=0;
		var hitHist=[];
		var hitIndex=0;
		var alphabet = "abcdefghijklmnopqrstuvwxyz";
		var newGameBoo=true;
		var winCheck="placeholder";
		var score=0;
		var roundscore=0;
		var combo=1;
		var roundEndTime;
		var roundCurrentTime=0;
		var roundStartTime=0;
		var difficulyMultiplier=1;
		var wonRounds=0;

		//SOUND EFFECTS
		var hitSound = new Audio();
		hitSound.src = 'assets/sounds/guessed_letter.mp3';
		hitSound.volume=.75;
		var hitSound2 = new Audio();
		hitSound2.src = 'assets/sounds/guessed_letter2.mp3';
		hitSound2.volume=.6;
		var killWord = new Audio();
		killWord.src = 'assets/sounds/kill_word.mp3';
		killWord.volume = .6;
		var killWord2 = new Audio();
		killWord2.src = 'assets/sounds/kill_word2.mp3';
		var missSound = new Audio();
		missSound.src = 'assets/sounds/wrong_letter.mp3';
		missSound.volume = .8;

		//FUNCTIONS HERE DUDEEEE!!!!!
		function playSound(sound){
			sound.play();
			sound.currentTime=0;
		}

		function displayRevealed(){
			wordToGuessRevealed=wordToGuessRevealedArr.toString();
			wordToGuessRevealed=wordToGuessRevealed.replace(/,/g,'');
			wordToGuessRevealed=wordToGuessRevealed.replace(/" "/g,"  ");
			wordToGuessRevealed=wordToGuessRevealed.replace(/_/g,'_ ');
			var lettersHitHTML="<p>"+wordToGuessRevealed+"</p>";
			document.querySelector('#lettersHit').innerHTML = lettersHitHTML;
		}

		function newGame(){
			counter=counterMax;
			GuessIndex=Math.floor(Math.random()*(wordToGuessArr.length))
			wordToGuess=wordToGuessArr[GuessIndex].toLowerCase();
			console.log(wordToGuess);

			wordToGuessRevealedArr=[];
				for(i=0;i<wordToGuess.length;i++){
					if(wordToGuess.charAt(i)!=" "){
						wordToGuessRevealedArr[i]='_';
					}
				else{
					wordToGuessRevealedArr[i]=" ";
				}
			}
			missIndex=0;
			guessHist=[];
			missHist.splice(0,missHist.length);
			displayRevealed();
		}

		function displayScore(){
			scoreHTML="<p>"+score+"</p>";
			document.querySelector('#score').innerHTML=scoreHTML;
		}

		function addRoundScore(){
			roundscore=50*combo;
			score=score+roundscore;
			combo++;
			displayScore();
		}

		function addEndOfRoundMultipler(){
			wonRounds++;
			var scoreMultiplier;
			roundEndTime=new Date().getTime();

			roundCompleteTime=(roundEndTime-roundStartTime)/1000;

			scoreMultiplier=parseInt(80/(roundCompleteTime)+2)*Math.pow((1+wonRounds/6),(1+wonRounds/15));

			score=Math.floor(score+(roundscore)*scoreMultiplier*difficulyMultiplier);

			roundscore=0;
			displayScore();
			roundStartTime=new Date().getTime();
		}

		function setRoundCurrentTime(){
			roundCurrentTime=(new Date().getTime()-roundStartTime)/1000
			timerHTML="<p>"+roundCurrentTime.toFixed(2) +"sec</p>";
			document.querySelector('#timer').innerHTML = timerHTML;
		}

//---------------------------CODE STARTS HERE------------------------------------
		

		document.onkeyup = function(event){

			//start new game and first round timer
			if(newGameBoo==true){
				newGame();
				newGameBoo=false;
				roundStartTime=new Date().getTime();
				setInterval(function() {setRoundCurrentTime()},50);
			}

			var guessValidation=false;

			//store guess
			var Guess = String.fromCharCode(event.keyCode).toLowerCase();

			//check to see if Guess is a letter and then if it has been guessed already
			if(alphabet.indexOf(Guess)>=0){
				if(guessHist.length!=0){
					for(i=0;i<guessHist.length;i++){
						if(guessHist[i]==Guess){
							break;
						}
				//store the guess in the history to check next time
						else if(i==guessHist.length-1){
							guessHist[k]=Guess;
							k++;
							guessValidation=true;
						}
					}
				}else{
					guessHist[k]=Guess;
					k++;
					guessValidation=true
				}
			}
		if(guessValidation==true){

			//check to see if letter is in the word

			var hitcount=0;

			for(i=0;i<wordToGuess.length;i++){
				if(wordToGuess.charAt(i)==Guess){
					wordToGuessRevealedArr[i]=Guess;
					hitcount++;
				}
			}

				if(hitcount==0){
			//store the letter in missHist to display misses. abc order for display
					playSound(missSound);
					missHist[missIndex]=Guess;
					missHist.sort();
					missIndex++;
					counter--;
					combo--;
					if(combo<=0){
						combo=1;
					}
				}
				else{
			//dunno why i did this but why not
					playSound(hitSound);
					playSound(hitSound2);
					hitHist[hitIndex]=Guess;
					hitHist.sort();
					hitIndex++;
					addRoundScore();
				}

			//check to see if user won the game
			winCheck=wordToGuessRevealedArr.toString();
			winCheck=winCheck.replace(/,/g,'');
			winCheck=winCheck.replace(/_ /g,'');

			//turn clear board on if user won. remove the element from the array if won and pick new word
			if(winCheck==wordToGuess){
				wordToGuessArr.splice(GuessIndex,1);
				addEndOfRoundMultipler();
				playSound(killWord);
				playSound(killWord2);
				newGame();
			}
			//display hits if game not over and not won
			else if(winCheck!=wordToGuess&&counter>0){
				displayRevealed();
			}
			//game over. pick new word but do not remove the word that you did not guess
			else{
				var lettersHitHTML="<p>Game Over</p>";
			}

			//display misses	
				var lettersMissedHTML = "<p>"+missHist+"</p>";

			//the actual queryselectors
			document.querySelector('#lettersMissed').innerHTML = lettersMissedHTML;
			document.querySelector('#counter').innerHTML= "<p>Tries Left: "+counter+"</p>";
			}
		}


		</script>





</body>
</html>